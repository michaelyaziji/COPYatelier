# Render Blueprint for Atelier Staging Environment
# https://render.com/docs/blueprint-spec

databases:
  - name: copyatelier-db
    plan: free
    databaseName: atelier
    user: atelier

services:
  # =============================================================================
  # FRONTEND - Next.js Application
  # =============================================================================
  - type: web
    name: copyatelier-frontend
    runtime: node
    plan: starter
    rootDir: frontend
    buildCommand: npm install && npm run build
    startCommand: npm run start
    envVars:
      - key: NEXT_PUBLIC_API_URL
        value: https://copyatelier-backend.onrender.com/api/v1
      - key: NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY
        value: pk_test_d2VsY29tZS1xdWV0emFsLTUwLmNsZXJrLmFjY291bnRzLmRldiQ
      - key: CLERK_SECRET_KEY
        value: sk_test_kfAuRihjGhtvmSIide4wsK07pfVg5U1QqC9qrTj848
      - key: NODE_ENV
        value: production

  # =============================================================================
  # BACKEND - FastAPI Application
  # =============================================================================
  - type: web
    name: copyatelier-backend
    runtime: python
    plan: starter
    rootDir: backend
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn app.main:app --host 0.0.0.0 --port $PORT
    envVars:
      # Database - auto-linked from copyatelier-db
      - key: DATABASE_URL
        fromDatabase:
          name: copyatelier-db
          property: connectionString

      # Application Settings
      - key: ENVIRONMENT
        value: staging
      - key: LOG_LEVEL
        value: INFO
      - key: AUTO_MIGRATE
        value: "true"
      - key: DATABASE_ECHO
        value: "false"

      # AI Provider API Keys
      - key: ANTHROPIC_API_KEY
        value: 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
      - key: GOOGLE_API_KEY
        value: AIzaSyCPkuy-exAm5i3IbYlDI35H0uQpZOld7ak
      - key: OPENAI_API_KEY
        value: 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
      - key: PERPLEXITY_API_KEY
        value: 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

      # Clerk Authentication
      - key: CLERK_ISSUER
        value: https://welcome-quetzal-50.clerk.accounts.dev
      - key: CLERK_JWKS_URL
        value: https://welcome-quetzal-50.clerk.accounts.dev/.well-known/jwks.json

      # Stripe Configuration
      - key: STRIPE_SECRET_KEY
        value: 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
      - key: STRIPE_WEBHOOK_SECRET
        value: whsec_1Crq9MJR9OPZo5Biddye24jVZ1roQC00
      - key: STRIPE_STARTER_PRICE_ID
        value: price_1SoOEcBl0wLtGjTQxskRytZe
      - key: STRIPE_PRO_PRICE_ID
        value: price_1SoOG0BlOwLtGjTQoFw0o0AC
      - key: STRIPE_STARTER_YEARLY_PRICE_ID
        value: price_1SoOFWBl0wLtGjTQBK7cgMVJ
      - key: STRIPE_PRO_YEARLY_PRICE_ID
        value: price_1SoOGGBlOwLtGjTQeK841ECf

      # Frontend URL (for Stripe redirects)
      - key: FRONTEND_URL
        value: https://copyatelier-frontend.onrender.com

      # CORS Configuration
      - key: CORS_ORIGINS
        value: https://copyatelier-frontend.onrender.com,http://localhost:3000
      - key: CORS_ALLOW_CREDENTIALS
        value: "true"

      # Email Configuration (SMTP)
      - key: SMTP_HOST
        value: smtp.hostinger.com
      - key: SMTP_PORT
        value: "465"
      - key: SMTP_USERNAME
        value: info@atelierwritereditor.com
      - key: SMTP_PASSWORD
        value: Compassion100!
      - key: SMTP_FROM_EMAIL
        value: Atelier <info@atelierwritereditor.com>
      - key: SMTP_USE_SSL
        value: "true"

# =============================================================================
# POST-DEPLOYMENT NOTE
# =============================================================================
# If Render adds a suffix to your service names (e.g., copyatelier-frontend-abc1),
# update these URLs in the Render dashboard:
#   - NEXT_PUBLIC_API_URL (frontend)
#   - CORS_ORIGINS (backend)
#   - FRONTEND_URL (backend)
